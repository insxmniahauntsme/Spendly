<!-- KpiCardStyle.xaml (full, with proper rounded clipping) -->
<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Spendly.Controls"
    xmlns:conv="clr-namespace:Spendly.Converters"
    xmlns:dashboard="clr-namespace:Spendly.Controls.Dashboard">
    
    <conv:ClipRectConverter x:Key="ClipRectConverter"/>
    <conv:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>

    <Style TargetType="{x:Type dashboard:KpiCard}">
        <Setter Property="FontFamily" Value="Sora"/>
        <Setter Property="Foreground" Value="{StaticResource Brush.Primary}"/>

        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type dashboard:KpiCard}">
                    <!-- OUTER BORDER: draws background + stroke -->
                    <Border x:Name="RootBorder"
                            CornerRadius="12"
                            Background="{StaticResource Brush.CardBg}"
                            BorderBrush="{StaticResource Brush.Border}"
                            BorderThickness="1">

                        <Border.Clip>
                            <MultiBinding Converter="{StaticResource ClipRectConverter}">
                                <Binding ElementName="RootBorder" Path="ActualWidth"/>
                                <Binding ElementName="RootBorder" Path="ActualHeight"/>
                                <Binding ElementName="RootBorder" Path="CornerRadius"/>
                            </MultiBinding>
                        </Border.Clip>

                            <Grid>

                                <!-- GLOW SPOT (ellipse)   -->
                                <Ellipse x:Name="Glow"
                                         Width="280"
                                         Height="240"
                                         HorizontalAlignment="Right"
                                         VerticalAlignment="Top"
                                         Margin="0,-145,-145,0"
                                         Opacity="0.60"
                                         IsHitTestVisible="False">
                                    <Ellipse.Fill>
                                        <RadialGradientBrush Center="0.5,0.5"
                                                             GradientOrigin="0.5,0.5"
                                                             RadiusX="0.5"
                                                             RadiusY="0.5">
                                            <GradientStop Color="{StaticResource Spendly.Primary.A60}" Offset="0.0"/>
                                            <GradientStop Color="{StaticResource Spendly.Primary.A10}" Offset="0.45"/>
                                            <GradientStop Color="Transparent" Offset="1.0"/>
                                        </RadialGradientBrush>
                                    </Ellipse.Fill>
                                    <Ellipse.Effect>
                                        <BlurEffect Radius="20"/>
                                    </Ellipse.Effect>
                                </Ellipse>

                                <!-- SUBTLE TOP HIGHLIGHT  -->
                                <Rectangle Opacity="0.22" IsHitTestVisible="False">
                                    <Rectangle.Fill>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                            <GradientStop Color="#22FFFFFF" Offset="0.0"/>
                                            <GradientStop Color="Transparent" Offset="0.65"/>
                                        </LinearGradientBrush>
                                    </Rectangle.Fill>
                                </Rectangle>

                                <!-- CONTENT               -->
                                <Grid Margin="16">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="10"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="10"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- TITLE -->
                                    <TextBlock FontSize="11"
                                               Foreground="{StaticResource Brush.TextMuted}"
                                               Text="{TemplateBinding Title}"/>

                                    <!-- VALUE -->
                                    <TextBlock x:Name="ValueTextBlock"
                                               Grid.Row="2"
                                               FontSize="22"
                                               FontWeight="SemiBold"
                                               Foreground="{TemplateBinding Foreground}"
                                               Text="{TemplateBinding ValueText}"/>

                                    <!-- BADGE + SUBTEXT -->
                                    <DockPanel Grid.Row="4">

                                        <Border x:Name="Badge"
                                                DockPanel.Dock="Left"
                                                CornerRadius="4"
                                                Padding="8,4"
                                                Background="{StaticResource Brush.PrimaryOverlay}"
                                                Visibility="{Binding BadgeText, RelativeSource={RelativeSource TemplatedParent}, 
                                                            Converter={StaticResource StringToVisibilityConverter}}">
                                            <TextBlock FontSize="11"
                                                       Foreground="{TemplateBinding Foreground}"
                                                       Text="{TemplateBinding BadgeText}"/>
                                        </Border>

                                        <TextBlock DockPanel.Dock="Right"
                                                   FontSize="11"
                                                   Foreground="{StaticResource Brush.TextMuted}"
                                                   Text="{TemplateBinding SubText}"/>
                                    </DockPanel>
                                </Grid>

                            </Grid>
                        </Border>

                    <!-- TRIGGERS              -->
                    <ControlTemplate.Triggers>

                        <!-- Primary -->
                        <Trigger Property="Variant" Value="Primary">
                            <Setter Property="Foreground" Value="{StaticResource Brush.Primary}"/>
                            <Setter TargetName="Badge" Property="Background" Value="{StaticResource Brush.PrimaryOverlay}"/>

                            <Setter TargetName="Glow" Property="Opacity" Value="0.60"/>
                            <Setter TargetName="Glow" Property="Fill">
                                <Setter.Value>
                                    <RadialGradientBrush Center="0.5,0.5" GradientOrigin="0.5,0.5" RadiusX="0.5" RadiusY="0.5">
                                        <GradientStop Color="{StaticResource Spendly.Primary.A60}" Offset="0.0"/>
                                        <GradientStop Color="{StaticResource Spendly.Primary.A10}" Offset="0.45"/>
                                        <GradientStop Color="Transparent" Offset="1.0"/>
                                    </RadialGradientBrush>
                                </Setter.Value>
                            </Setter>
                        </Trigger>

                        <!-- Success -->
                        <Trigger Property="Variant" Value="Success">
                            <Setter Property="Foreground" Value="{StaticResource Brush.Success}"/>
                            <Setter TargetName="Badge" Property="Background" Value="{StaticResource Brush.SuccessOverlay}"/>

                            <Setter TargetName="Glow" Property="Opacity" Value="0.60"/>
                            <Setter TargetName="Glow" Property="Fill">
                                <Setter.Value>
                                    <RadialGradientBrush Center="0.5,0.5" GradientOrigin="0.5,0.5" RadiusX="0.5" RadiusY="0.5">
                                        <GradientStop Color="{StaticResource Spendly.Success.A60}" Offset="0.0"/>
                                        <GradientStop Color="{StaticResource Spendly.Success.A10}" Offset="0.45"/>
                                        <GradientStop Color="Transparent" Offset="1.0"/>
                                    </RadialGradientBrush>
                                </Setter.Value>
                            </Setter>
                        </Trigger>

                        <!-- Danger -->
                        <Trigger Property="Variant" Value="Danger">
                            <Setter Property="Foreground" Value="{StaticResource Brush.Danger}"/>
                            <Setter TargetName="Badge" Property="Background" Value="{StaticResource Brush.DangerOverlay}"/>

                            <Setter TargetName="Glow" Property="Opacity" Value="0.60"/>
                            <Setter TargetName="Glow" Property="Fill">
                                <Setter.Value>
                                    <RadialGradientBrush Center="0.5,0.5" GradientOrigin="0.5,0.5" RadiusX="0.5" RadiusY="0.5">
                                        <GradientStop Color="{StaticResource Spendly.Danger.A60}" Offset="0.0"/>
                                        <GradientStop Color="{StaticResource Spendly.Danger.A10}" Offset="0.45"/>
                                        <GradientStop Color="Transparent" Offset="1.0"/>
                                    </RadialGradientBrush>
                                </Setter.Value>
                            </Setter>
                        </Trigger>

                        <!-- Warning -->
                        <Trigger Property="Variant" Value="Warning">
                            <Setter Property="Foreground" Value="{StaticResource Brush.Warning}"/>
                            <Setter TargetName="Badge" Property="Background" Value="{StaticResource Brush.WarningOverlay}"/>

                            <Setter TargetName="Glow" Property="Opacity" Value="0.45"/>
                            <Setter TargetName="Glow" Property="Fill">
                                <Setter.Value>
                                    <RadialGradientBrush Center="0.5,0.5" GradientOrigin="0.5,0.5" RadiusX="0.5" RadiusY="0.5">
                                        <GradientStop Color="{StaticResource Spendly.Warning.A60}" Offset="0.0"/>
                                        <GradientStop Color="{StaticResource Spendly.Warning.A10}" Offset="0.45"/>
                                        <GradientStop Color="Transparent" Offset="1.0"/>
                                    </RadialGradientBrush>
                                </Setter.Value>
                            </Setter>
                        </Trigger>

                        <!-- Neutral -->
                        <Trigger Property="Variant" Value="Neutral">
                            <Setter Property="Foreground" Value="{StaticResource Brush.TextPrimary}"/>
                            <Setter TargetName="Badge" Property="Background" Value="{StaticResource Brush.NeutralOverlay}"/>

                            <Setter TargetName="Glow" Property="Opacity" Value="0.35"/>
                            <Setter TargetName="Glow" Property="Fill">
                                <Setter.Value>
                                    <RadialGradientBrush Center="0.5,0.5" GradientOrigin="0.5,0.5" RadiusX="0.5" RadiusY="0.5">
                                        <GradientStop Color="{StaticResource Spendly.TextMuted.A60}" Offset="0.0"/>
                                        <GradientStop Color="{StaticResource Spendly.TextMuted.A10}" Offset="0.45"/>
                                        <GradientStop Color="Transparent" Offset="1.0"/>
                                    </RadialGradientBrush>
                                </Setter.Value>
                            </Setter>
                        </Trigger>

                        <!-- IsEmpty override -->
                        <Trigger Property="IsEmpty" Value="True">
                            <Setter TargetName="ValueTextBlock" Property="Text" Value="â€”"/>
                            <Setter Property="Foreground" Value="{StaticResource Brush.TextMuted}"/>
                            <Setter TargetName="Badge" Property="Background" Value="{StaticResource Brush.NeutralOverlay}"/>

                            <Setter TargetName="Glow" Property="Opacity" Value="0.35"/>
                            <Setter TargetName="Glow" Property="Fill">
                                <Setter.Value>
                                    <RadialGradientBrush Center="0.5,0.5" GradientOrigin="0.5,0.5" RadiusX="0.5" RadiusY="0.5">
                                        <GradientStop Color="{StaticResource Spendly.TextMuted.A60}" Offset="0.0"/>
                                        <GradientStop Color="{StaticResource Spendly.TextMuted.A10}" Offset="0.45"/>
                                        <GradientStop Color="Transparent" Offset="1.0"/>
                                    </RadialGradientBrush>
                                </Setter.Value>
                            </Setter>
                        </Trigger>

                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>